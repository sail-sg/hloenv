HloModule jit_prune_neighbor_list_sparse.248

jit_vmap_remainder_.34 {
  Arg_0.35 = f32[2700,2]{1,0} parameter(0)
  Arg_1.36 = f32[] parameter(1)
  broadcast.40 = f32[2700,2]{1,0} broadcast(Arg_1.36), dimensions={}
  remainder.41 = f32[2700,2]{1,0} remainder(Arg_0.35, broadcast.40)
  constant.38 = f32[] constant(0)
  broadcast.39 = f32[2700,2]{1,0} broadcast(constant.38), dimensions={}
  compare.43 = pred[2700,2]{1,0} compare(remainder.41, broadcast.39), direction=LT
  constant.37 = f32[] constant(0)
  compare.44 = pred[] compare(Arg_1.36, constant.37), direction=LT
  broadcast.45 = pred[2700,2]{1,0} broadcast(compare.44), dimensions={}
  compare.46 = pred[2700,2]{1,0} compare(compare.43, broadcast.45), direction=NE
  compare.42 = pred[2700,2]{1,0} compare(remainder.41, broadcast.39), direction=NE
  and.47 = pred[2700,2]{1,0} and(compare.46, compare.42)
  broadcast.48 = f32[2700,2]{1,0} broadcast(Arg_1.36), dimensions={}
  add.49 = f32[2700,2]{1,0} add(remainder.41, broadcast.48)
  ROOT select.50 = f32[2700,2]{1,0} select(and.47, add.49, remainder.41)
}

region_0.54 {
  Arg_0.55 = f32[] parameter(0)
  Arg_1.56 = f32[] parameter(1)
  ROOT add.57 = f32[] add(Arg_0.55, Arg_1.56)
}

cumsum.62 {
  Arg_0.63 = s32[2700]{0} parameter(0)
  slice.173 = s32[1]{0} slice(Arg_0.63), slice={[0:1]}
  slice.65 = s32[1350]{0} slice(Arg_0.63), slice={[0:2699:2]}
  slice.66 = s32[1350]{0} slice(Arg_0.63), slice={[1:2700:2]}
  add.67 = s32[1350]{0} add(slice.65, slice.66)
  slice.165 = s32[1]{0} slice(add.67), slice={[0:1]}
  slice.68 = s32[675]{0} slice(add.67), slice={[0:1349:2]}
  slice.69 = s32[675]{0} slice(add.67), slice={[1:1350:2]}
  add.70 = s32[675]{0} add(slice.68, slice.69)
  slice.157 = s32[1]{0} slice(add.70), slice={[0:1]}
  slice.71 = s32[337]{0} slice(add.70), slice={[0:674:2]}
  slice.72 = s32[337]{0} slice(add.70), slice={[1:675:2]}
  add.73 = s32[337]{0} add(slice.71, slice.72)
  slice.150 = s32[1]{0} slice(add.73), slice={[0:1]}
  slice.74 = s32[168]{0} slice(add.73), slice={[0:336:2]}
  slice.75 = s32[168]{0} slice(add.73), slice={[1:337:2]}
  add.76 = s32[168]{0} add(slice.74, slice.75)
  slice.143 = s32[1]{0} slice(add.76), slice={[0:1]}
  slice.77 = s32[84]{0} slice(add.76), slice={[0:167:2]}
  slice.78 = s32[84]{0} slice(add.76), slice={[1:168:2]}
  add.79 = s32[84]{0} add(slice.77, slice.78)
  slice.135 = s32[1]{0} slice(add.79), slice={[0:1]}
  slice.80 = s32[42]{0} slice(add.79), slice={[0:83:2]}
  slice.81 = s32[42]{0} slice(add.79), slice={[1:84:2]}
  add.82 = s32[42]{0} add(slice.80, slice.81)
  slice.127 = s32[1]{0} slice(add.82), slice={[0:1]}
  slice.83 = s32[21]{0} slice(add.82), slice={[0:41:2]}
  slice.84 = s32[21]{0} slice(add.82), slice={[1:42:2]}
  add.85 = s32[21]{0} add(slice.83, slice.84)
  slice.119 = s32[1]{0} slice(add.85), slice={[0:1]}
  slice.86 = s32[10]{0} slice(add.85), slice={[0:20:2]}
  slice.87 = s32[10]{0} slice(add.85), slice={[1:21:2]}
  add.88 = s32[10]{0} add(slice.86, slice.87)
  slice.112 = s32[1]{0} slice(add.88), slice={[0:1]}
  slice.89 = s32[5]{0} slice(add.88), slice={[0:9:2]}
  slice.90 = s32[5]{0} slice(add.88), slice={[1:10:2]}
  add.91 = s32[5]{0} add(slice.89, slice.90)
  slice.104 = s32[1]{0} slice(add.91), slice={[0:1]}
  slice.92 = s32[2]{0} slice(add.91), slice={[0:4:2]}
  slice.93 = s32[2]{0} slice(add.91), slice={[1:5:2]}
  add.94 = s32[2]{0} add(slice.92, slice.93)
  slice.98 = s32[1]{0} slice(add.94), slice={[0:1]}
  constant.64 = s32[] constant(0)
  pad.99 = s32[2]{0} pad(slice.98, constant.64), padding=0_1_1
  slice.95 = s32[1]{0} slice(add.94), slice={[0:1:2]}
  slice.96 = s32[1]{0} slice(add.94), slice={[1:2:2]}
  add.97 = s32[1]{0} add(slice.95, slice.96)
  pad.100 = s32[2]{0} pad(add.97, constant.64), padding=1_0_1
  add.101 = s32[2]{0} add(pad.99, pad.100)
  slice.102 = s32[2]{0} slice(add.91), slice={[2:5:2]}
  add.103 = s32[2]{0} add(add.101, slice.102)
  concatenate.105 = s32[3]{0} concatenate(slice.104, add.103), dimensions={0}
  pad.106 = s32[5]{0} pad(concatenate.105, constant.64), padding=0_0_1
  pad.107 = s32[5]{0} pad(add.101, constant.64), padding=1_1_1
  add.108 = s32[5]{0} add(pad.106, pad.107)
  slice.109 = s32[4]{0} slice(add.108), slice={[0:4]}
  slice.110 = s32[4]{0} slice(add.88), slice={[2:10:2]}
  add.111 = s32[4]{0} add(slice.109, slice.110)
  concatenate.113 = s32[5]{0} concatenate(slice.112, add.111), dimensions={0}
  pad.114 = s32[10]{0} pad(concatenate.113, constant.64), padding=0_1_1
  pad.115 = s32[10]{0} pad(add.108, constant.64), padding=1_0_1
  add.116 = s32[10]{0} add(pad.114, pad.115)
  slice.117 = s32[10]{0} slice(add.85), slice={[2:21:2]}
  add.118 = s32[10]{0} add(add.116, slice.117)
  concatenate.120 = s32[11]{0} concatenate(slice.119, add.118), dimensions={0}
  pad.121 = s32[21]{0} pad(concatenate.120, constant.64), padding=0_0_1
  pad.122 = s32[21]{0} pad(add.116, constant.64), padding=1_1_1
  add.123 = s32[21]{0} add(pad.121, pad.122)
  slice.124 = s32[20]{0} slice(add.123), slice={[0:20]}
  slice.125 = s32[20]{0} slice(add.82), slice={[2:42:2]}
  add.126 = s32[20]{0} add(slice.124, slice.125)
  concatenate.128 = s32[21]{0} concatenate(slice.127, add.126), dimensions={0}
  pad.129 = s32[42]{0} pad(concatenate.128, constant.64), padding=0_1_1
  pad.130 = s32[42]{0} pad(add.123, constant.64), padding=1_0_1
  add.131 = s32[42]{0} add(pad.129, pad.130)
  slice.132 = s32[41]{0} slice(add.131), slice={[0:41]}
  slice.133 = s32[41]{0} slice(add.79), slice={[2:84:2]}
  add.134 = s32[41]{0} add(slice.132, slice.133)
  concatenate.136 = s32[42]{0} concatenate(slice.135, add.134), dimensions={0}
  pad.137 = s32[84]{0} pad(concatenate.136, constant.64), padding=0_1_1
  pad.138 = s32[84]{0} pad(add.131, constant.64), padding=1_0_1
  add.139 = s32[84]{0} add(pad.137, pad.138)
  slice.140 = s32[83]{0} slice(add.139), slice={[0:83]}
  slice.141 = s32[83]{0} slice(add.76), slice={[2:168:2]}
  add.142 = s32[83]{0} add(slice.140, slice.141)
  concatenate.144 = s32[84]{0} concatenate(slice.143, add.142), dimensions={0}
  pad.145 = s32[168]{0} pad(concatenate.144, constant.64), padding=0_1_1
  pad.146 = s32[168]{0} pad(add.139, constant.64), padding=1_0_1
  add.147 = s32[168]{0} add(pad.145, pad.146)
  slice.148 = s32[168]{0} slice(add.73), slice={[2:337:2]}
  add.149 = s32[168]{0} add(add.147, slice.148)
  concatenate.151 = s32[169]{0} concatenate(slice.150, add.149), dimensions={0}
  pad.152 = s32[337]{0} pad(concatenate.151, constant.64), padding=0_0_1
  pad.153 = s32[337]{0} pad(add.147, constant.64), padding=1_1_1
  add.154 = s32[337]{0} add(pad.152, pad.153)
  slice.155 = s32[337]{0} slice(add.70), slice={[2:675:2]}
  add.156 = s32[337]{0} add(add.154, slice.155)
  concatenate.158 = s32[338]{0} concatenate(slice.157, add.156), dimensions={0}
  pad.159 = s32[675]{0} pad(concatenate.158, constant.64), padding=0_0_1
  pad.160 = s32[675]{0} pad(add.154, constant.64), padding=1_1_1
  add.161 = s32[675]{0} add(pad.159, pad.160)
  slice.162 = s32[674]{0} slice(add.161), slice={[0:674]}
  slice.163 = s32[674]{0} slice(add.67), slice={[2:1350:2]}
  add.164 = s32[674]{0} add(slice.162, slice.163)
  concatenate.166 = s32[675]{0} concatenate(slice.165, add.164), dimensions={0}
  pad.167 = s32[1350]{0} pad(concatenate.166, constant.64), padding=0_1_1
  pad.168 = s32[1350]{0} pad(add.161, constant.64), padding=1_0_1
  add.169 = s32[1350]{0} add(pad.167, pad.168)
  slice.170 = s32[1349]{0} slice(add.169), slice={[0:1349]}
  slice.171 = s32[1349]{0} slice(Arg_0.63), slice={[2:2700:2]}
  add.172 = s32[1349]{0} add(slice.170, slice.171)
  concatenate.174 = s32[1350]{0} concatenate(slice.173, add.172), dimensions={0}
  pad.175 = s32[2700]{0} pad(concatenate.174, constant.64), padding=0_1_1
  pad.176 = s32[2700]{0} pad(add.169, constant.64), padding=1_0_1
  ROOT add.177 = s32[2700]{0} add(pad.175, pad.176)
}

jit__cumulative_reduction.178 {
  Arg_0.179 = pred[2700]{0} parameter(0)
  convert.180 = s32[2700]{0} convert(Arg_0.179)
  ROOT call.181 = s32[2700]{0} call(convert.180), to_apply=cumsum.62
}

jit__where.184 {
  Arg_0.185 = pred[2700]{0} parameter(0)
  Arg_1.186 = s32[2700]{0} parameter(1)
  Arg_2.187 = s32[] parameter(2)
  broadcast.188 = s32[2700]{0} broadcast(Arg_2.187), dimensions={}
  ROOT select.189 = s32[2700]{0} select(Arg_0.185, Arg_1.186, broadcast.188)
}

region_1.195 {
  Arg_0.196 = s32[] parameter(0)
  ROOT Arg_1.197 = s32[] parameter(1)
}

region_2.203 {
  Arg_0.204 = s32[] parameter(0)
  ROOT Arg_1.205 = s32[] parameter(1)
}

ENTRY main.215 {
  constant.10 = s32[] constant(100)
  broadcast.11 = s32[2700]{0} broadcast(constant.10), dimensions={}
  Arg_0.1 = f32[100,2]{1,0} parameter(0)
  iota.18 = s32[100]{0} iota(), iota_dimension=0
  broadcast.19 = s32[100,27]{1,0} broadcast(iota.18), dimensions={0}
  reshape.20 = s32[2700]{0} reshape(broadcast.19)
  constant.6 = s32[] constant(0)
  broadcast.7 = s32[2700]{0} broadcast(constant.6), dimensions={}
  compare.22 = pred[2700]{0} compare(reshape.20, broadcast.7), direction=LT
  add.23 = s32[2700]{0} add(reshape.20, broadcast.11)
  select.24 = s32[2700]{0} select(compare.22, add.23, reshape.20)
  reshape.25 = s32[2700,1]{1,0} reshape(select.24)
  gather.26 = f32[2700,2]{1,0} gather(Arg_0.1, reshape.25), offset_dims={1}, collapsed_slice_dims={0}, start_index_map={0}, index_vector_dim=1, slice_sizes={1,2}
  Arg_1.2 = s32[100,27]{1,0} parameter(1)
  reshape.21 = s32[2700]{0} reshape(Arg_1.2)
  compare.27 = pred[2700]{0} compare(reshape.21, broadcast.7), direction=LT
  add.28 = s32[2700]{0} add(reshape.21, broadcast.11)
  select.29 = s32[2700]{0} select(compare.27, add.28, reshape.21)
  reshape.30 = s32[2700,1]{1,0} reshape(select.29)
  gather.31 = f32[2700,2]{1,0} gather(Arg_0.1, reshape.30), offset_dims={1}, collapsed_slice_dims={0}, start_index_map={0}, index_vector_dim=1, slice_sizes={1,2}
  subtract.32 = f32[2700,2]{1,0} subtract(gather.26, gather.31)
  constant.15 = f32[] constant(20)
  broadcast.16 = f32[2700,2]{1,0} broadcast(constant.15), dimensions={}
  add.33 = f32[2700,2]{1,0} add(subtract.32, broadcast.16)
  constant.17 = f32[] constant(40)
  call.51 = f32[2700,2]{1,0} call(add.33, constant.17), to_apply=jit_vmap_remainder_.34
  subtract.52 = f32[2700,2]{1,0} subtract(call.51, broadcast.16)
  multiply.53 = f32[2700,2]{1,0} multiply(subtract.52, subtract.52)
  constant.14 = f32[] constant(0)
  reduce.58 = f32[2700]{0} reduce(multiply.53, constant.14), dimensions={1}, to_apply=region_0.54
  constant.12 = f32[] constant(13.4067955)
  broadcast.13 = f32[2700]{0} broadcast(constant.12), dimensions={}
  compare.59 = pred[2700]{0} compare(reduce.58, broadcast.13), direction=LT
  compare.60 = pred[2700]{0} compare(reshape.21, broadcast.11), direction=LT
  and.61 = pred[2700]{0} and(compare.59, compare.60)
  call.182 = s32[2700]{0} call(and.61), to_apply=jit__cumulative_reduction.178
  constant.8 = s32[] constant(1)
  broadcast.9 = s32[2700]{0} broadcast(constant.8), dimensions={}
  subtract.183 = s32[2700]{0} subtract(call.182, broadcast.9)
  constant.3 = s32[] constant(2699)
  call.190 = s32[2700]{0} call(and.61, subtract.183, constant.3), to_apply=jit__where.184
  compare.191 = pred[2700]{0} compare(call.190, broadcast.7), direction=LT
  constant.4 = s32[] constant(2700)
  broadcast.5 = s32[2700]{0} broadcast(constant.4), dimensions={}
  add.192 = s32[2700]{0} add(call.190, broadcast.5)
  select.193 = s32[2700]{0} select(compare.191, add.192, call.190)
  reshape.194 = s32[2700,1]{1,0} reshape(select.193)
  scatter.198 = s32[2700]{0} scatter(broadcast.11, reshape.194, reshape.21), update_window_dims={}, inserted_window_dims={0}, scatter_dims_to_operand_dims={0}, index_vector_dim=1, to_apply=region_1.195
  slice.209 = s32[2699]{0} slice(scatter.198), slice={[0:2699]}
  reshape.211 = s32[1,2699]{1,0} reshape(slice.209)
  compare.199 = pred[2700]{0} compare(call.190, broadcast.7), direction=LT
  add.200 = s32[2700]{0} add(call.190, broadcast.5)
  select.201 = s32[2700]{0} select(compare.199, add.200, call.190)
  reshape.202 = s32[2700,1]{1,0} reshape(select.201)
  scatter.206 = s32[2700]{0} scatter(broadcast.11, reshape.202, reshape.20), update_window_dims={}, inserted_window_dims={0}, scatter_dims_to_operand_dims={0}, index_vector_dim=1, to_apply=region_2.203
  slice.210 = s32[2699]{0} slice(scatter.206), slice={[0:2699]}
  reshape.212 = s32[1,2699]{1,0} reshape(slice.210)
  concatenate.213 = s32[2,2699]{1,0} concatenate(reshape.211, reshape.212), dimensions={0}
  slice.207 = s32[1]{0} slice(call.182), slice={[2699:2700]}
  reshape.208 = s32[] reshape(slice.207)
  ROOT tuple.214 = (s32[2,2699]{1,0}, s32[]) tuple(concatenate.213, reshape.208)
}

